<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - MotoCash</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-body: #121214;
            --bg-card: #202024;
            --bg-input: #121214;
            --primary: #8257e5;
            --green: #04d361;
            --red: #f75a68;
            --text-main: #e1e1e6;
            --text-muted: #8d8d99;
            --border: #323238;
        }

        body {
            background-color: var(--bg-body);
            color: var(--text-main);
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
        }

        /* Utilit√°rios de Texto e Cor */
        .text-green { color: var(--green) !important; }
        .text-red { color: var(--red) !important; }
        .text-muted-custom { color: var(--text-muted) !important; }

        /* Cards e Boxes */
        .box, .card {
            background-color: var(--bg-card);
            border-radius: 12px;
            border: 1px solid var(--border);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .box { padding: 1.5rem; }

        /* Inputs e Formul√°rios */
        .form-control, .form-select {
            background-color: var(--bg-input);
            border: 1px solid var(--border);
            color: var(--text-main);
            border-radius: 8px;
            padding: 0.75rem;
        }

        .form-control:focus, .form-select:focus {
            background-color: var(--bg-input);
            border-color: var(--primary);
            color: var(--text-main);
            box-shadow: 0 0 0 2px rgba(130, 87, 229, 0.25);
        }

        .form-control::placeholder { color: #555; }

        /* Barra de Progresso */
        .barra-fundo {
            background-color: var(--bg-input);
            border-radius: 99px;
            height: 12px;
            overflow: hidden;
            border: 1px solid var(--border);
        }

        .barra-progresso {
            background: linear-gradient(90deg, #04d361 0%, #00b37e 100%);
            height: 100%;
            border-radius: 99px;
            transition: width 0.5s ease;
        }

        /* Bot√µes */
        .btn-primary {
            background-color: var(--primary);
            border: none;
            font-weight: 600;
        }
        .btn-primary:hover { background-color: #9466ff; }
        
        .btn-success {
            background-color: var(--green);
            border: none;
            color: #000;
            font-weight: 700;
        }
        .btn-success:hover { background-color: #00b37e; }

        /* Lista de Transa√ß√µes (Estilo Mobile) */
        .transaction-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 0;
            border-bottom: 1px solid var(--border);
        }
        .transaction-item:last-child { border-bottom: none; }
        
        .icon-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            margin-right: 1rem;
        }
        .icon-up { background: rgba(4, 211, 97, 0.1); color: var(--green); }
        .icon-down { background: rgba(247, 90, 104, 0.1); color: var(--red); }

        /* Efeito de Blur para o modo Privacidade */
        .blur-text {
            filter: blur(6px);
            user-select: none;
            transition: filter 0.3s ease;
        }
    </style>
</head>
<body>

    <div class="container py-4" style="max-width: 600px;">
        
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <small class="text-muted-custom">Bem-vindo de volta,</small>
                <h2 class="fw-bold m-0">{{ nome }}</h2>
            </div>
            <a href="{{ url_for('logout') }}" class="btn btn-outline-danger btn-sm border-0">
                <i class="fas fa-sign-out-alt fa-lg"></i>
            </a>
        </div>

        <div class="box mb-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="m-0 fw-bold"><i class="fas fa-bullseye text-primary me-2"></i>Meta Di√°ria</h5>
                <span class="badge bg-dark text-white border border-secondary">R$ {{ meta }}</span>
            </div>
            
            <div class="barra-fundo mb-2">
                <div class="barra-progresso" style="width: {{ largura_barra }}%;"></div>
            </div>
            
            <div class="d-flex justify-content-between small mb-3">
                <span class="text-white">{{ porcentagem }}% conclu√≠do</span>
                {% if fat_dia < meta %}
                    <span class="text-muted-custom">Falta: <strong class="text-white">R$ {{ '%.2f'|format(meta - fat_dia) }}</strong></span>
                {% else %}
                    <span class="text-green fw-bold">Meta batida! üöÄ</span>
                {% endif %}
            </div>

            <form action="{{ url_for('definir_meta') }}" method="POST" class="input-group">
                <input type="number" name="meta" step="0.01" value="{{ meta }}" class="form-control" placeholder="Nova meta" required>
                <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i></button>
            </form>
        </div>

        <div class="row g-3 mb-4">
            <div class="col-12">
                <div class="card p-4 position-relative overflow-hidden" style="background: linear-gradient(135deg, #29292e 0%, #202024 100%);">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <span class="text-muted-custom small text-uppercase fw-bold ls-1">Saldo L√≠quido</span>
                            <h1 class="fw-bold text-white mt-1 mb-0">
                                R$ <span class="valor-mascara">{{ saldo_dia }}</span>
                            </h1>
                        </div>
                        <button onclick="alternarPrivacidade()" class="btn btn-link text-muted-custom p-0">
                            <i id="icone-olho" class="fas fa-eye fa-lg"></i>
                        </button>
                    </div>
                    <i class="fas fa-wallet position-absolute" style="bottom: -10px; right: -10px; font-size: 5rem; opacity: 0.05; color: white;"></i>
                </div>
            </div>

            <div class="col-6">
                <div class="card p-3 text-center border-0" style="background: rgba(4, 211, 97, 0.05);">
                    <small class="text-green fw-bold mb-1 d-block"><i class="fas fa-arrow-up me-1"></i> Ganho</small>
                    <h5 class="fw-bold text-white m-0">R$ <span class="valor-mascara">{{ fat_dia }}</span></h5>
                </div>
            </div>
            
            <div class="col-6">
                <div class="card p-3 text-center border-0" style="background: rgba(247, 90, 104, 0.05);">
                    <small class="text-red fw-bold mb-1 d-block"><i class="fas fa-arrow-down me-1"></i> Gasto</small>
                    <h5 class="fw-bold text-white m-0">R$ <span class="valor-mascara">{{ gasto_dia }}</span></h5>
                </div>
            </div>
        </div>

        <div class="box mb-4">
            <h5 class="mb-3 fw-bold">Novo Lan√ßamento</h5>
            <form action="{{ url_for('adicionar') }}" method="POST" class="row g-2">
                <div class="col-4">
                    <select name="tipo" class="form-select text-center fw-bold" required>
                        <option value="entrada" class="text-success">Win</option>
                        <option value="saida" class="text-danger">Loss</option>
                    </select>
                </div>
                <div class="col-8">
                    <input type="number" name="valor" step="0.01" class="form-control" placeholder="R$ 0,00" required>
                </div>
                <div class="col-12">
                    <input type="text" name="descricao" class="form-control" placeholder="Descri√ß√£o (Ex: iFood, Gasolina)" required>
                </div>
                <div class="col-12 mt-3">
                    <button type="submit" class="btn btn-success w-100 py-2 rounded-3">
                        <i class="fas fa-plus me-2"></i> ADICIONAR
                    </button>
                </div>
            </form>
        </div>

        <div class="box mb-4">
            <h5 class="mb-3 fw-bold small text-uppercase text-muted-custom">Performance Semanal</h5>
            <div style="height: 200px;">
                <canvas id="graficoSemanal"></canvas>
            </div>
        </div>

        <h5 class="mb-3 fw-bold px-1">Hoje</h5>
        <div class="card px-3">
            <div class="d-flex flex-column">
                {% for t in transacoes %}
                <div class="transaction-item">
                    <div class="d-flex align-items-center">
                        <div class="icon-circle {{ 'icon-up' if t.tipo == 'entrada' else 'icon-down' }}">
                            <i class="fas {{ 'fa-arrow-up' if t.tipo == 'entrada' else 'fa-arrow-down' }}"></i>
                        </div>
                        <div>
                            <span class="d-block fw-bold text-white">{{ t.descricao }}</span>
                            <small class="text-muted-custom">{{ 'Entrada' if t.tipo == 'entrada' else 'Sa√≠da' }}</small>
                        </div>
                    </div>
                    <span class="fw-bold {{ 'text-green' if t.tipo == 'entrada' else 'text-red' }}">
                        {{ '+' if t.tipo == 'entrada' else '-' }} R$ <span class="valor-mascara">{{ t.valor }}</span>
                    </span>
                </div>
                {% else %}
                <div class="text-center py-5 text-muted-custom">
                    <i class="fas fa-receipt fa-2x mb-2 opacity-50"></i>
                    <p class="m-0">Nenhum movimento hoje.</p>
                </div>
                {% endfor %}
            </div>
        </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    
    <script>
        // Script simples para garantir que a fun√ß√£o de privacidade funcione visualmente com as novas classes
        const originalToggle = window.alternarPrivacidade; // Salva refer√™ncia se existir
        
        window.alternarPrivacidade = function() {
            const elements = document.querySelectorAll('.valor-mascara');
            const icon = document.getElementById('icone-olho');
            
            // Verifica estado atual baseado em um elemento
            const isBlur = elements[0] && elements[0].classList.contains('blur-text');
            
            elements.forEach(el => {
                if (isBlur) {
                    el.classList.remove('blur-text');
                } else {
                    el.classList.add('blur-text');
                }
            });

            // Alterna √≠cone
            if (icon) {
                icon.classList.toggle('fa-eye');
                icon.classList.toggle('fa-eye-slash');
            }
            
            // Chama a fun√ß√£o original se ela fazia algo extra (como salvar no localStorage)
            if (typeof originalToggle === 'function' && originalToggle !== window.alternarPrivacidade) {
                // originalToggle(); 
            }
        }
    </script>

</body>
</html>